<!DOCTYPE html>
<html class="themeDark">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1, maximum-scale=1, minimal-ui" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="msapplication-tap-highlight" content="no" />
	<title>Its a trapp! | BEKK</title>
	<link href="/css/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<header class="header">
		<div class="u-container">
			<div class="u-row">
				<a class="header-brand" href="/">BEKK</a>
			</div>
		</div>
	</header>

	<script>
		var w = window.innerWidth;
		var h = window.innerHeight - 400;
		
		window.addEventListener("resize", function(){
			w = window.innerWidth;
			h = window.innerHeight - 400;
		});
	</script>

	<script src="src/vendors/processing.min.js"></script>


<script type="text/processing" data-processing-target="waves">
// Data stream
float dataStream;
//------------

float g;
int savedTime;
int totalTime = 10;
float strokeT = 1;

void setup() {
	size(w, h);
	smooth();
	colorMode(RGB);
	//frameRate();
	background(20);
	strokeCap(ROUND);

	savedTime = millis();

	// Data stream
	dataStream=.0;
	//------------
	socialcast=0;

	var host = location.origin.replace(/^file/, 'ws');
	var ws = new WebSocket("ws://localhost:8013/");
	ws.onmessage = function(event) {
		console.log(JSON.parse(event.data));
		document.querySelector('#socialcast').firstChild.nodeValue = Math.min(Math.floor(event.data*100.),100);
		document.querySelector('#socialcast-bar').style.width = Math.min(Math.floor(event.data*100.),100);
		socialcast = float(event.data);
		redraw();
	};

	noLoop();

	g=0;
}

void draw() {
	translate(0, h/2);
	theLine();
}

void theLine() {

	// Data stream
	dataStream=dataStream+.01;
	//------------

	int passedTime = millis() - savedTime;

	noiseSeed(13120);
	float noiseVal = map(socialcast, 0, 1, 0, h/3);

	noiseSeed(10130);
	float noiseVal2 = map(noise(dataStream), 0, 1, 0, h/2);

	noiseSeed(152);
	float noiseVal3 = map(noise(dataStream), 0, 1, 0, h/2);

	if (passedTime > totalTime) {

		//Time-Warp
		strokeWeight(12);
		stroke(20,20,20,100);
		line(g+10, h/2, g+10, -h/2);

		if (g<w) {
			g=g+12;
		} else {
			g=0;
		}

		// Thin line
		stroke(79, 191, 178); // GRØNN
		strokeWeight(strokeT);
		line(g, noiseVal2/1.5, g, -noiseVal2/1.5);

		//Dot grid
		strokeWeight(strokeT);
		stroke(79, 191, 178); // GRØNN
		for (int i=0; i<noiseVal2/1.5; i=i+5) {
			point(g-3, -i);
			point(g+3, -i);
			point(g-3, i+2);
			point(g+3, i+2);
		}

		// Cricles
		stroke(253, 253, 170); // GUL
		noFill();
		strokeWeight(strokeT);
		ellipse(g, -noiseVal3/1.5-3, 8, 8);
		ellipse(g, noiseVal3/1.5+3, 8, 8);
		ellipse(g, -noiseVal3/1.5-3, 4, 4);
		ellipse(g, noiseVal3/1.5+3, 4, 4);
		point(g, -noiseVal3/1.5-3);
		point(g, noiseVal3/1.5+3);

		//Small cricles
		stroke(253, 253, 170); // GUL
		ellipse(g, -noiseVal2/1.5-3, 2, 2);
		ellipse(g, noiseVal2/1.5+3, 2, 2);

		//Fat line
		strokeWeight(7);
		stroke(244, 76, 89); // RØD
		line(g, noiseVal/2, g, -noiseVal/2);

		//Thin black line
		strokeWeight(1);
		stroke(30);
		line(g, noiseVal3/2, g, -noiseVal3/2);

		savedTime = millis();
	}
}


</script>

<canvas id="waves"></canvas>

	<main class="u-container">
		<div class="u-row">
			<div class="keyfigure-item" data-component="socialcast">
				<div class="keyfigure-content">
					<div class="keyfigure-content--top">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="289.4 228.6 264.4 134.8" xml:space="preserve">
						</svg>
					</div>
					<div class="keyfigure-value t-meta"></div>
				</div>

				<a href="#" class="keyfigure-link t-meta t-meta--secondary">
					<span>Socialcast</span>
				</a>
			</div>
			
			<div class="keyfigure-item" data-component="distance">
				<div class="keyfigure-content">
					<div class="keyfigure-content--top">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="289.4 228.6 264.4 134.8" xml:space="preserve">
						</svg>
					</div>
					<div class="keyfigure-value t-meta"></div>
				</div>

				<a href="#" class="keyfigure-link t-meta t-meta--secondary">
					<span>Avstand</span>
				</a>
			</div>
			<div class="keyfigure-item" data-component="sound">
				<div class="keyfigure-content">
					<div class="keyfigure-content--top">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="289.4 228.6 264.4 134.8" xml:space="preserve">
						</svg>
					</div>
					<div class="keyfigure-value t-meta"></div>
				</div>

				<a href="#" class="keyfigure-link t-meta t-meta--secondary">
					<span>Lydnivå</span>
				</a>
			</div>
		</div>
	</main>
	<script src="/js/app.js"></script>
</body>
</html>
